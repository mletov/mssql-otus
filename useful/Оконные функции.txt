NTILE дели на группы примерно поровну, количество групп в скобках NTILE(3)
1 1 1 2 2

Почитать про 
ROWS UNBOUND PRECEDING / FOLLOWING
RANGE


Функция распределения в %


В OVER можем засунуть CASE